<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BATCOMPUTER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--red:#b30000;--bg:#000;--panel:#111;--text:#e0e0e0}
body{margin:0;background:var(--bg);color:var(--text);font-family:monospace}
.hidden{display:none}
.screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:black}
.panel{border:1px solid var(--red);background:var(--panel);padding:14px;width:90%;max-width:420px}
h2{margin:0 0 8px 0;color:var(--red);font-size:14px}
input,textarea,select{width:100%;background:black;color:var(--text);border:1px solid var(--red);padding:6px;margin-bottom:6px}
button{background:black;color:var(--red);border:1px solid var(--red);padding:6px 10px}
.log{font-size:12px;opacity:.85;white-space:pre-wrap;margin-top:6px}
.small{font-size:11px;opacity:.7}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen">
  <div class="panel">
    <h2>SECURE ACCESS</h2>
    <input id="pass" type="password" placeholder="Enter passphrase">
    <button onclick="unlock()">UNLOCK</button>
    <div class="small" id="status"></div>
  </div>
</div>

<!-- BOOT -->
<div id="boot" class="screen hidden"><div id="bootText"></div></div>

<!-- OS -->
<div id="os" class="hidden" style="padding:12px">

<div class="panel">
<h2>SYSTEM STATUS</h2>
MODE: SOLO OPERATOR<br>
ENCRYPTION: AES-GCM ACTIVE<br>
CONTEXT: HONOLULU – SECTOR 3
</div>

<div class="panel">
<h2>ACTIVE CASE</h2>
<input id="caseName" placeholder="Case name">
<button onclick="setCase()">SET CASE</button>
<div class="small" id="activeCase"></div>
</div>

<div class="panel">
<h2>LOG ENTRY</h2>
<select id="type">
<option value="observation">Observation</option>
<option value="emotion">Internal State</option>
<option value="review">After-Action Review</option>
</select>
<input id="tags" placeholder="Tags">
<textarea id="text" rows="3"></textarea>
<button onclick="saveEntry()">SAVE</button>
</div>

<div class="panel">
<h2>DISCIPLINE</h2>
<input id="discipline">
<button onclick="saveDiscipline()">LOG</button>
<div id="disciplineLog"></div>
</div>

<div class="panel">
<h2>TIMELINE</h2>
<div id="timeline"></div>
</div>

</div>

<script>
const PASSWORD="vengeance";
let cryptoKey=null;
let memory=[];

/* CRYPTO */
async function deriveKey(pw,salt){
  const enc=new TextEncoder();
  const base=await crypto.subtle.importKey("raw",enc.encode(pw),"PBKDF2",false,["deriveKey"]);
  return crypto.subtle.deriveKey(
    {name:"PBKDF2",salt,iterations:100000,hash:"SHA-256"},
    base,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]
  );
}

async function encrypt(data){
  const iv=crypto.getRandomValues(new Uint8Array(12));
  const enc=new TextEncoder();
  const buf=await crypto.subtle.encrypt({name:"AES-GCM",iv},cryptoKey,enc.encode(JSON.stringify(data)));
  localStorage.setItem("bat_iv",Array.from(iv));
  localStorage.setItem("bat_data",btoa(String.fromCharCode(...new Uint8Array(buf))));
}

async function decrypt(){
  const iv=new Uint8Array(JSON.parse(localStorage.getItem("bat_iv")));
  const data=Uint8Array.from(atob(localStorage.getItem("bat_data")),c=>c.charCodeAt(0));
  const buf=await crypto.subtle.decrypt({name:"AES-GCM",iv},cryptoKey,data);
  return JSON.parse(new TextDecoder().decode(buf));
}

/* LOGIN */
async function unlock(){
  if(pass.value!==PASSWORD){status.textContent="ACCESS DENIED";return}
  const salt=new TextEncoder().encode("batcomputer");
  cryptoKey=await deriveKey(PASSWORD,salt);

  if(localStorage.getItem("bat_data")){
    try{memory=await decrypt()}catch{memory=[]}
  }

  login.classList.add("hidden");
  startBoot();
}

function startBoot(){
  boot.classList.remove("hidden");
  const lines=[
    "VERIFYING CREDENTIALS",
    "DECRYPTING MEMORY",
    "RESTORING CONTEXT",
    "SYSTEM STABLE",
    "ACCESS GRANTED"
  ];
  let i=0;bootText.innerHTML="";
  const t=setInterval(()=>{
    bootText.innerHTML+=lines[i]+"<br>";
    i++;
    if(i===lines.length){
      clearInterval(t);
      setTimeout(()=>{
        boot.classList.add("hidden");
        os.classList.remove("hidden");
        render();
      },700);
    }
  },600);
}

/* DATA */
function setCase(){
  localStorage.setItem("activeCase",caseName.value||"UNASSIGNED");
  render();
}

async function saveEntry(){
  memory.unshift({
    type:type.value,
    text:text.value,
    tags:tags.value,
    time:new Date().toLocaleString(),
    case:localStorage.getItem("activeCase")
  });
  await encrypt(memory);
  text.value="";tags.value="";
  render();
}

async function saveDiscipline(){
  memory.unshift({
    type:"discipline",
    text:discipline.value,
    time:new Date().toLocaleString(),
    case:localStorage.getItem("activeCase")
  });
  await encrypt(memory);
  discipline.value="";
  render();
}

function render(){
  const c=localStorage.getItem("activeCase")||"UNASSIGNED";
  activeCase.textContent="ACTIVE: "+c;
  timeline.innerHTML="";disciplineLog.innerHTML="";
  memory.filter(e=>e.case===c).forEach(e=>{
    const d=document.createElement("div");
    d.className="log";
    d.textContent=`[${e.type.toUpperCase()}] ${e.time}\n${e.text}`;
    timeline.appendChild(d);
    if(e.type==="discipline"){
      const dl=document.createElement("div");
      dl.className="log";
      dl.textContent=e.time+" – "+e.text;
      disciplineLog.appendChild(dl);
    }
  });
}
</script>

</body>
</html>
